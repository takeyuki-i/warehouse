使用期限の近い製品をお知らせします。

<%if @state.nil? %>
      <% @states.each do |state|%>
       <% if state.limit_id == 2 %>
          <% limit_day = state.limit_day.to_date %>
          <% alarm = limit_day - @today %>
          <% if alarm <= 10 && 0 <= alarm %>
              <%= "-------------------------------"%>
              <%= "残り日数#{alarm.to_i}日"%>
              <%= "　"%>
              <%= "Item:#{state.item.name}"%>
              <%= "Id:#{state.id}"%>
              <%= "数量：#{state.quantity} "%><%= state.unit.name %>
              <%= "使用期限：#{state.limit_day.strftime("%Y年%m月%d日")}"%>
          <% end %>
        <% end %>
      <% end %>
      <% @states.each do |state|%>
        <% if state.limit_id == 2 %>
          <% limit_day = state.limit_day.to_date %>
          <% alarm = limit_day - @today %>
          <% if alarm < 0 %>
              <%= "-------------------------------"%>
              <%= "期限から【#{alarm.to_i.abs}日】経過"%>
              <%= "　"%>
              <%= "Item:#{state.item.name}"%>
              <%= "Id:#{state.id}"%>
              <%= "数量：#{state.quantity} "%><%= state.unit.name %>
              <%= "使用期限：#{state.limit_day.strftime("%Y年%m月%d日")}"%>
          <% end %>
        <% end %>
      <% end %>
<% else %>
  なし
<% end %>
